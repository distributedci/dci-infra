---
- name: Ensure dci-analytics package is installed
  package:
    name:
      - dci-analytics
    state: latest
    update_cache: yes

- name: Run podman auto-update
  ansible.builtin.shell: podman auto-update

- name: Create environment file used by the dci-analytics container
  become: true
  template:
    src: "dci-analytics.env.j2"
    dest: "/run/dci-analytics.env"
    mode: 0644
  notify: Restart dci-analytics container

- name: enable dci-analytics services
  become: true
  systemd:
    name: "{{ item }}"
    enabled: yes
    daemon_reload: true
  loop:
    - dci-analytics.service
    - dci-analytics-sync.timer
    - dci-analytics-sync.service

- name: start dci-analytics services
  become: true
  systemd:
    name: "{{ item }}"
    state: started
    daemon_reload: true
  loop:
    - dci-analytics.service
    - dci-analytics-sync.timer
